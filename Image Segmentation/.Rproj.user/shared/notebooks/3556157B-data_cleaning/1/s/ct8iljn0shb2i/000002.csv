"0","school_check3 <- kamsc3"
"0","n <- length(school_check3$ID)"
"0","check3 <- data.frame(matrix(0, n, 8))"
"0","colnames(check3) <-  colnames(school_check3[, 4:11])"
"0","popularity_count <- c(rep(0,n))"
"0",""
"0","for (i in 1:n){#For each ID"
"0","  for (j in 1:8){ #for each kam column"
"0","    recipient <- school_check3[i,j +3]"
"0","    if(recipient %in% 10:12){ #handle special cases 10, 11, 12"
"0","      check3[i,j] <- recipient"
"0","    }else{"
"0","      index_recipient <- which(school_check3$ID == recipient)"
"0","      if (!length(index_recipient) ){ #recipient not found"
"0","        check3[i,j] <- 777"
"0","      } else{"
"0","        popularity_count[i] <- popularity_count[i] + 1"
"0","        if ((school_check3$V3_E_Skola[index_recipient] %>% toString() %>% nchar()) == 1 ){ #recipient has empty school field"
"0","          check3[i,j] <- 2"
"0","        } else{"
"0","          if (school_check3$V3_E_Skola[index_recipient] != school_check3$V3_E_Skola[i]){ #both have schools but they're different"
"0","            check3[i,j] <- 1"
"0","          }"
"0","          if (school_check3$V3_E_Klass[index_recipient] == school_check3$V3_E_Klass[i]){"
"0","            check3[i,j] <- 0.5"
"0","          }"
"0","        }"
"0","      "
"0","      }"
"0","      "
"0","    }"
"0","  }"
"0","}"
"0","#Assembling final table"
"0","check3$ID <- school_check3$ID"
"0","check3$nNominations <- popularity_count"
"0","check3 <- check3[, c(9,10,1,2,3,4,5,6,7,8)]"
"0",""
"0","#making summary of results"
"0","# ask for better way to do so!"
"0",""
"0","#taking into acc all categories"
"0","#need to add a dummy variable for code purposes on last column. "
"0",""
"0","check3[7,4:10] <- c(rep(1,7)) #will be subtracted on counting step"
"0","check3[4,10] <- 777"
"0","total <- 8*n #number of total observation)"
"0","current_table <- table(check3[,3])"
"0","for (i in 4:10){"
"0","  current_table <- current_table + table(check3[,i])"
"0","}"
"0","current_table <- (current_table/total)*100 #getting percentage"
"0","summary3 <- data.frame(current_table)"
"0","colnames(summary3) <- c(""Nomination type"", ""Percentage"")"
"0",""
"0","#only counting 0s and 1s"
"0","summary3$Only_Counting_0_1 <- c(""% of 0s"", ""% of 1s"", rep(NA, 6))"
"0","tot_0_1 <- sum(check3==1, check3==0, check3==0.5) -7"
"0","summary3$n <- c((sum(check3==0)+ sum(check3==0.5))/tot_0_1*100, (sum(check3==1)-7)/tot_0_1*100, rep(NA, 6))"
"0",""
"0","#Counting how many of the in-school nominations are also bet same classrooms"
"0","summary3$From_0s_inSameClass <- c(""% of nominations staying in same classroom"", ""% of nominations outside classroom"", rep(NA, 6))"
"0","tot_0_05 <- sum(check3==0.5, check3==0)"
"0","summary3$N <- c(sum(check3==0)/tot_0_05*100, sum(check3==0.5)/tot_0_05*100, rep(NA, 6))"
"0",""
"0","#Saving csvs"
"0","#write.csv(check3, 'Y:/eco_redhead/LoRDIA/database/Check_bet_schools3.csv', row.names = FALSE)"
"0","write.csv(summary3, 'Y:/eco_redhead/LoRDIA/database/Summary_check3.csv', row.names = FALSE)"
