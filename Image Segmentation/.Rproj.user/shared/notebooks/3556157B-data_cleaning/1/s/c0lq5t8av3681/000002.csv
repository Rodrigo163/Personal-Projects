"0","school_check1 <- kamsc1 #keeping original data intact in case something goes wrong"
"0","n <- length(school_check1$ID)"
"0",""
"0","check1 <- data.frame(matrix(0, n, 8)) #initializing check matrix"
"0","colnames(check1) <-  colnames(school_check1[, 4:11])"
"0","popularity_count <- c(rep(0,n)) #init. popularity vector"
"0",""
"0","for (i in 1:n){#For each ID"
"0","  for (j in 1:8){ #for each kam column"
"0","    recipient <- school_check1[i,j+3]"
"0","    if(recipient %in% 10:12){ #handle special cases 10, 11, 12"
"0","      check1[i,j] <- recipient"
"0","    }else{"
"0","      index_recipient <- which(school_check1$ID == recipient)"
"0","      if (!length(index_recipient) ){ #recipient not found"
"0","        check1[i,j] <- 777"
"0","      } else{"
"0","        popularity_count[i] <- popularity_count[i] + 1"
"0","        if ((school_check1$V1_E_Skola[index_recipient] %>% toString() %>% nchar()) == 1 ){ #recipient has empty school field"
"0","          check1[i,j] <- 2"
"0","        } else{"
"0","          if (school_check1$V1_E_Skola[index_recipient] != school_check1$V1_E_Skola[i]){ #both have schools but they're different"
"0","            check1[i,j] <- 1"
"0","          }"
"0","          if (school_check1$V1_E_Klass[index_recipient] == school_check1$V1_E_Klass[i]){ #same school and same classroom"
"0","            check1[i,j] <- 0.5"
"0","          }"
"0","        }"
"0","      "
"0","      }"
"0","      "
"0","    }"
"0","  }"
"0","}"
"0","check1$ID <- school_check1$ID"
"0","check1$nNominated <- popularity_count"
"0","check1 <- check1[, c(9,10,1,2,3,4,5,6,7,8)]"
"0",""
"0",""
"0","#making summary of results"
"0","# ask for better way to do so!"
"0","total <- 8*n #number of total observation"
"0",""
"0","#adding 1s to subtract them later. This allows table method to work"
"0","check1[7,5:10] <- c(rep(1,6))"
"0","current_table <- table(check1[,3])"
"0","for (i in 4:10){"
"0","  current_table <- current_table + table(check1[,i])"
"0","}"
"0","current_table <- (current_table/total)*100"
"0","summary1 <- data.frame(current_table)"
"0","colnames(summary1) <- c(""Nomination type"", ""Percentage"")"
"0",""
"0","#only counting 0s and 1s"
"0","summary1$Only_Counting_0_1 <- c(""% of 0s"", ""% of 1s"", rep(NA, 6))"
"0","tot_0_1 <- sum(check1==1, check1==0, check1==0.5)-6 #to account for the added ones"
"0","summary1$n <- c((sum(check1==0)+ sum(check1==0.5))/tot_0_1*100, (sum(check1==1)-6)/tot_0_1*100, rep(NA, 6))"
"0",""
"0","#Counting how many of the in-school nominations are also bet same classrooms"
"0","summary1$From_0s_inSameClass <- c(""% of nominations staying in same classroom"", ""% of nominations outside classroom"", rep(NA, 6))"
"0","tot_0_05 <- sum(check1==0.5, check1==0)"
"0","summary1$N <- c(sum(check1==0)/tot_0_05*100, sum(check1==0.5)/tot_0_05*100, rep(NA, 6))"
"0",""
"0","#saving final files"
"0","#write.csv(check1, 'Y:/eco_redhead/LoRDIA/database/Check_bet_schools1.csv', row.names = FALSE)"
"0","write.csv(summary1, 'Y:/eco_redhead/LoRDIA/database/Summary_check1.csv', row.names = FALSE)"
