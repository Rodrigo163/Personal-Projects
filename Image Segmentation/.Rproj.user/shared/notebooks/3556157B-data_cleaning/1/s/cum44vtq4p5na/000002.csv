"0","school_check2 <- kamsc2"
"0","n <- length(school_check2$ID)"
"0","check2 <- data.frame(matrix(0, n, 8))"
"0","colnames(check2) <-  colnames(school_check2[, 4:11])"
"0","popularity_count <- c(rep(0,n))"
"0",""
"0","for (i in 1:n){#For each ID"
"0","  for (j in 1:8){ #for each kam column"
"0","    recipient <- school_check2[i,j +3]"
"0","    if(recipient %in% 10:12){ #handle special cases 10, 11, 12"
"0","      check2[i,j] <- recipient"
"0","    }else{"
"0","      index_recipient <- which(school_check2$ID == recipient)"
"0","      if (!length(index_recipient) ){ #recipient not found"
"0","        check2[i,j] <- 777"
"0","      } else{"
"0","        popularity_count[i] <- popularity_count[i] + 1"
"0","        if ((school_check2$V2_E_Skola[index_recipient] %>% toString() %>% nchar()) == 1 ){ #recipient has empty school field"
"0","          check2[i,j] <- 2"
"0","        } else{"
"0","          if (school_check2$V2_E_Skola[index_recipient] != school_check2$V2_E_Skola[i]){ #both have schools but they're different"
"0","            check2[i,j] <- 1"
"0","          }"
"0","          if (school_check2$V2_E_Klass[index_recipient] == school_check2$V2_E_Klass[i]){"
"0","            check2[i,j] <- 0.5"
"0","          }"
"0","        }"
"0","      "
"0","      }"
"0","      "
"0","    }"
"0","  }"
"0","}"
"0","#Assembling final table"
"0","check2$ID <- school_check2$ID"
"0","check2$nNominations <- popularity_count"
"0","check2 <- check2[, c(9,10,1,2,3,4,5,6,7,8)]"
"0",""
"0","#making summary of results"
"0","# ask for better way to do so!"
"0","total <- 8*n #number of total observation)"
"0","check2[11,4:8] <- c(rep(1,5))"
"0","current_table <- table(check2[,3])"
"0","for (i in 4:10){"
"0","  current_table <- current_table + table(check2[,i])"
"0","}"
"0","current_table <- (current_table/total)*100 #getting percentage"
"0","summary2 <- data.frame(current_table)"
"0","colnames(summary2) <- c(""Nomination type"", ""Percentage"")"
"0",""
"0","#only counting 0s and 1s"
"0","summary2$Only_Counting_0_1 <- c(""% of 0s"", ""% of 1s"", rep(NA, 6))"
"0","tot_0_1 <- sum(check2==1, check2==0, check2==0.5)-5"
"0","summary2$n <- c((sum(check2==0)+ sum(check2==0.5))/tot_0_1*100, (sum(check2==1)-5)/tot_0_1*100, rep(NA, 6))"
"0",""
"0","#Counting how many of the in-school nominations are also bet same classrooms"
"0","summary2$From_0s_inSameClass <- c(""% of nominations staying in same classroom"", ""% of nominations outside classroom"", rep(NA, 6))"
"0","tot_0_05 <- sum(check2==0.5, check2==0)"
"0","summary2$N <- c(sum(check2==0)/tot_0_05*100, sum(check2==0.5)/tot_0_05*100, rep(NA, 6))"
"0",""
"0","#Saving data"
"0","#write.csv(check2, 'Y:/eco_redhead/LoRDIA/database/Check_bet_schools2.csv', row.names = FALSE)"
"0","write.csv(summary2, 'Y:/eco_redhead/LoRDIA/database/Summary_check2.csv', row.names = FALSE)"
